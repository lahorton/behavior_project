{% extends 'base.html' %}

{% block content %}

<h2>Student History</h2>

<p>Student Name : {{ student.fname }} {{ student.lname }}</p>
<p>Birthdate : {{ student.birthdate }}</p>


<a href="/add_progress/{{ student.student_id }}" name="new_progress"> Add a new progress report! </a>

<h3>Behaviors being tracked. Click on behavior to see history:</h3>

<ul id="student_progress">
    {% for item in behaviors %}
        <li> <a href="/student_history/{{ student.student_id }}/behavior_history?behavior_name={{ item }}" name="behavior_history">{{ item }}</a><br>
         </li>
     {% endfor %}
</ul>



<canvas id="myChart" width="400" height="100"></canvas>

<script type="text/javascript">
// let behaviors =   behaviors_json|tojson  
// behaviors = JSON.parse(behaviors)
// console.log(behaviors);
// let names = []
// for (let date in behaviors){
//     console.log(date + ':', behaviors[date]);
//     names.push(date);
//     for (let item in behaviors[date]){
//         console.log(item + ':', behaviors[date][item]);
//     }
// }

let behavior = {{ chart_json|tojson }}
behavior = JSON.parse(behavior)
// console.log(behavior);

// for (let k in behavior){
//     console.log(k);
//     console.log(behavior[k]['labels']);
//     console.log(behavior[k]['background_color']);
//     console.log(behavior[k]['border_color']);
//     console.log(behavior[k]['data']);
// }


const data_ary = [];
for (let b in behavior){
    const b_name = new Object(); 
    b_name.label = b;
    b_name.backgroundColor = behavior[b]['background_color'];
    b_name.borderColor = behavior[b]['border_color'];
    b_name.data = behavior[b]['data'];
    b_name.fill= false;
    data_ary.push(b_name);
}

console.log(data_ary); 

let ctx = document.getElementById('myChart').getContext('2d');
let chart = new Chart(ctx, {
    // The type of chart we want to create
    type: 'line',

    // The data for our dataset
        data: {
            labels: ['Jan', 'Feb', 'March', 'April', 'May', 'June',
                     'July', 'August', 'Sept', 'Oct', 'Nov', 'Dec'],
            datasets: data_ary
            }
    });

</script>

<h3> Progress Reports: </h3>

<ul id="student_progress">
    {% for item in progress %}
        <li> Progress Report: <br>
             Date: {{ item.date }}<br>
             Behavior: {{ item.behavior.behavior_name }}<br>
             Intervention: {{ item.intervention.intervention_name }}<br>
             User_id: {{ item.user_id }}<br>
             Rating: {{ item.rating }}<br>
             Comment: {{ item.comment }}<br>
             <br>
        </li>
    {% endfor %}
</ul>


{% endblock %} 